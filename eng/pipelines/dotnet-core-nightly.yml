trigger:
  batch: true
  branches:
    include:
    - nightly
  paths:
    include:
    - manifest.json
    - manifest.versions.json
    - src/*
pr: none

resources:
  repositories:
  - repository: InternalVersionsRepo
    type: github
    endpoint: dotnet
    name: dotnet/versions

variables:
- template: /eng/pipelines/variables/core.yml@self
- name: officialBranches
  # comma-delimited list of branch names
  value: nightly

extends:
  template: /eng/common/templates/1es-official.yml@self
  parameters:
    stages:
    - stage: Build_and_Test
      displayName: Build and Test
      jobs:
      - job: Build_and_Test
        displayName: Build and Test
        pool:
          name: NetCore1ESPool-Internal
          image: 1es-windows-2022
          os: windows
        steps:
        - powershell: >
            pwsh
            -Command "./eng/Get-DropVersions.ps1
            -BuildId 2525144
            -InternalArtifactsAccessToken $(System.AccessToken)
            -updatedependencies
            -UseInternalBuild"
          displayName: Update dependencies and generate dockerfiles
